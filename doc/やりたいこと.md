# やりたいこと

更新者：DNV825
更新日：2021/10/25(Mon) 01:28

## 目的

1. 2007年ごろに作った「ふるいわけ.htm」と同等の機能をC\# & WPFで再現する（※1）
1. 出来上がったものをブラッシュアップする。

※1：MAUIというのもこれから出てくるらしいが、とりあえずWPFでやってみる。

## 「ふるいわけ.htm」とは

「ふるいわけ.htm」はInternet ExplorerとActiveX（FileSystmeObject）で作成したアプリで、

- htmlファイルと同じフォルダに配置された画像ファイルを一覧表示し、選んだ画像をサブフォルダへ移動する

ことを目的としている。

ファイルのタイムスタンプは2007/10/18なので、14年近く前の古いスクリプトではあるが、2021年現在も問題なく動作する。

しかし、Windows 10で動作するInternet Explorerは2022/06/16（日本時間）にサポートが終了するので、同等の機能を別の手段で実現したい（そういうツールは誰かが作っていそうだが、探すのも面倒くさい。）

### 「ふるいわけ.htm」の画面仕様

「ふるいわけ.htm」は以下のように画面を表示する。

```plantuml
@startsalt
caption 図2-1：「ふるいわけ.htm」の画面イメージ
!procedure _image($x)
{+
.
.
\t $x \t
.
.
}
!endprocedure
{SI
  {
    [] ファイル名1 | [] ファイル名2 | [] ファイル名3 | [] ファイル名4 | [] ファイル名5
    _image(image1) |
    _image(image2) |
    _image(image3) |
    _image(image4) |
    _image(image5)
    [] ファイル名6 | [] ファイル名7 | [] ファイル名8 | [] ファイル名9 | [] ファイル名10
    _image(image6) |
    _image(image7) |
    _image(image8) |
    _image(image9) |
    _image(image10)
    [] ファイル名11 | [] ファイル名12 | [] ファイル名13 | [] ファイル名14 | [] ファイル名15
    _image(image11) |
    _image(image12) |
    _image(image13) |
    _image(image14) |
    _image(image15)
    [] ファイル名16 | [] ファイル名17 | [] ファイル名18 | [] ファイル名19 | [] ファイル名20
    _image(image16) |
    _image(image17) |
    _image(image18) |
    _image(image19) |
    _image(image20)
    | -- | -- | \t\t<b>①</b>\t | -- | -- 
  } |
  {
    108 | . | ... <b>②</b>
    [全チェック選択] | [全チェック解除] | ... <b>③</b>
    "            " | [フォルダ作成] | ... <b>④</b>
    {SI
      フォルダ1
      フォルダ2
      フォルダ3
      フォルダ4
      フォルダ5
      フォルダ6
      フォルダ7
      フォルダ8
      フォルダ9
      フォルダ10
    } | . | ... <b>⑤</b>
    [フォルダへ移動]
  }
}
@endsalt
```

| 番号 | 表示内容の説明 |
| --- | --- |
| ① | ファイル名と画像を表示するエリア。画像の縦横サイズは固定値に変換して表示する。ファイル名の左にチェックボックスを表示し、チェックしたファイルを移動対象とする。ファイル名・画像はハイパーリンクになっており、クリックすると元画像を表示する。 |
| ② | フォルダ内に存在する画像の件数を表示するエリア。どのファイルが画像ファイルであるかは拡張子で判別している。 |
| ③ | チェックボックスの全選択・全解除を行うボタン。 |
| ④ | 移動先フォルダとなるフォルダを作成するエリア。テキストボックスに入力した名前でカレントフォルダに新フォルダを作成する。 |
| ⑤ | 画像の移動先フォルダを選択するリストと、選択したフォルダへ画像を移動するボタン。 |

### 「ふるいわけ.htm」の動作

「ふるいわけ.htm」の動作フローは以下の通り。

```plantuml
@startuml
caption 図2-2：「ふるいわけ.htm」の動作フロー
|ユーザー|
|ふるいわけ.htm|

|ユーザー|
start
note right
  画像を整理したいフォルダに
  ふるいわけ.htmを配置済みとする。
end note
:ふるいわけ.htmを起動する;

|ふるいわけ.htm|
:htmlの要素を表示する;
:カレントフォルダのサブフォルダを読み込む;
:⑤のリストにサブフォルダ名を表示する;
(A)
:カレントフォルダの画像を読み込む;
note right
  読み込む画像の種類は
  ・jpg または jpeg
  ・png
  ・gif
  としていた。
end note
:②に画像の件数を表示する;
if (画像の件数が100件以上であるか？) then (99件以下である)
  :全件の画像を読み込む;
else (100件以上である)
  :1件目から100件目の画像を読み込む;
endif
:①に読み込んだ画像を表示する;

|ユーザー|
if (画像が存在するか？) then (存在しない)
  stop
else (存在する)

endif

if (画像にふさわしい\n移動先フォルダがあるか？) then (移動先フォルダがある)
  :④のリストから移動先フォルダを選択する;
else (移動先フォルダがない)
  :④のテキストボックスに新フォルダ名を入力する;
  :④の［フォルダ作成］ボタンを押下する;
  |ふるいわけ.htm|
  :カレントフォルダに新フォルダを作成する;
  :④のリストの表示を更新する;
  note right
    表示を更新し、
    作成したフォルダを
    表示する。
  end note
  |ユーザー|
  :④のリストから追加したフォルダを選択する;
endif

while (移動先フォルダにふさわしい\n画像の選択は完了しているか？) is (\n完了していない)
  if (元の大きさで画像を見たいか？) then (見たくない)
    :何もしない}
  else (見たい)
    :ファイル名、または画像をクリックする;
    |ふるいわけ.htm|
      :クリックした画像を元の大きさで別タブに表示する;
    |ユーザー|
  endif
  if (画像を移動対象にするか？) then (移動対象にしない)
    :何もしない}
  else (移動対象にする)
    :画像をチェックボックスを有効にする;
  endif
endwhile 
->完了している;
:⑤の［フォルダへ移動］ボタンを押下する;
|ふるいわけ.htm|
:選択された画像を指定されたサブフォルダへ移動する;
(A)
note right
  ①の表示を更新する。
end note
detach
@enduml
```
